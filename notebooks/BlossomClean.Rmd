---
title: "Blossom Cleaning"
output: html_notebook
---

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(stringr)
```


```{r}
#Open Scraped Data-set
run_data = readRDS("../data/external/run_data1999-2012.rds")
head(run_data)
```

### Data Quality Observations
* All values are chararacter
* Age needs to be converted to int type
* Time and Pace need to be converted to minutes

#### Age Conversion
```{r}
# Convert age to int
## Age Conversion - NR stands for Not Recorded, replaced with NA
run_data$Age <- as.numeric(run_data$Age)
```

```{r}
## Time Clean Up
# Some times have * after time - not sure what it means yet, but creating a column to market it
run_data$hasTimeAsterisk <- 0

# Some years have asterisk in time
if (sum(grep("\\*", run_data$Time)) > 0){
  run_data[grep("\\*", run_data$Time),]$hasTimeAsterisk <- 1 # Adds indicators of having asterisk
}

# Remove Asterisk from time
run_data$Time<-gsub("\\*", "",  run_data$Time)

# add time in minutes
# problem is the format is inconsistent, some are in mm:ss and some in hh:mm:ss
# 1. mm:ss only
# 2. hh:mm:ss only
# 3. mix of mm:ss and hh:mm:ss

convert_time <- function(time_vector){
  m <- str_split(time_vector, ":", simplify = TRUE)
  
  if (ncol(m) == 3){ # If problem #2 or #3
    time_vector <- if_else(m[,3] == "", as.numeric(m[,1]) + as.numeric(m[,2]) / 60, 
            as.numeric(m[,1]) * 60 + as.numeric(m[,2]) + as.numeric(m[,3]) / 60)
  } else if (ncol(m) == 2){ # If problem #1
    time_vector <- as.numeric(m[,1]) + as.numeric(m[,2]) / 60
  }
  
  return(time_vector)
}

run_data$TimeInMin <- convert_time(run_data$Time)
run_data$PaceInMin <- convert_time(run_data$Pace)

head(run_data$TimeInMin)
```

```{r}
unique(run_data$Race)
## Validate Ages
summary(run_data$Age)
```

```{r}
## Select male data
male_data = filter(run_data, Sex == "M") %>% 
  select(Name, Age, Year, TimeInMin)

head(male_data)
plot(male_data$Age~male_data$TimeInMin)
```

```{r}
## Male boxplots, age by year
boxplot(as.numeric(Age)~Year, data=male_data)
```

```{r}
## Male boxplots, time by age group
maleAgeCat = cut(as.numeric(male_data$Age), breaks= c(seq(15, 75, 10), 90))
plot(male_data$TimeInMin ~ maleAgeCat)
```

```{r}
## Select female data
female_data = filter(run_data, Sex == "W") %>%
  select(Name, Age, Year, TimeInMin)

head(female_data)
plot(female_data$Age~female_data$TimeInMin)
```

```{r}
## Female boxplots, age by year
boxplot(as.numeric(Age)~Year, data=female_data)
```

```{r}
## Female boxplots, time by age group
femaleAgeCat = cut(as.numeric(female_data$Age), breaks= c(seq(15, 75, 10), 90))
table(femaleAgeCat)
plot(female_data$TimeInMin ~ femaleAgeCat)
```

